<% provide(:title, @book.title) %>
<div id="book-<%= @book.id %>" class="show-book">
  <div class="center_container col-lg-5 col-md-5 col-sm-4">
    <%= image_tag(@book.cover) unless @book.cover.nil? %>
  </div>

  <div class="col-lg-7 col-md-7 col-sm-8">
    <h2 class="title"><%=link_to @book.title, @book%></h2>
    <h4 class="author"><%= link_to @book.author, author_url(author: @book.author) %></h4>
    <ul>
    <li>req: <%= @book.requesters %></li>
    <li class="quality"><span class="attr">Skick:</span> <span class="info"><%=  @book.quality %></span></li>
    <% if @book.language.nil? || @book.language.empty?%>
    <li class="year"><span class="attr">Språk:</span> <span class="info">Ej angivet</span></li>
    <% else %>
    <li class="year"><span class="attr">Språk:</span> <span class="info"><%= @book.language %></span></li>
    <% end %>
    <% if @book.genre.nil? || @book.genre.empty? %>
    <li class="genre"><span class="attr">Genre:</span> <span class="info">Ej angivet</span></li>
    <% else %>
    <li class="genre"><span class="attr">Genre:</span> <span class="info"><%= link_to @book.genre, genre_url(genre: @book.genre)%></span></li>
    <% end %>

    <% if @book.pages.nil?%>
    <li class="year"><span class="attr">Sidor:</span> <span class="info">Ej angivet</span></li>
    <% else %>
    <li class="year"><span class="attr">Sidor:</span> <span class="info"><%= @book.pages %></span></li>
    <% end %>

    <% if @book.year.nil? %>
    <li class="year"><span class="attr">Utgivningsår:</span> <span class="info">Ej angivet</span></li>
    <% else %>
    <li class="year"><span class="attr">Utgivningsår:</span> <span class="info"><%= @book.year.to_formatted_s(:y) %></span></li>
    <% end %>

    <li class="location"><span class="attr">Ort:</span>
      <span class="info">
      <%= link_to @book.user.location, location_url(location: @book.user.location)%>,
      <%= link_to @book.user.landscape, landscape_url(landscape: @book.user.landscape)%>
      </span>
    </li>
    <% if logged_in? %>
    <li class="givenby"><span class="attr">Ges bort av:</span> <span class="info"><%= link_to @book.user.name, @book.user %></span></li>
    <li class="swaps"><span class="attr">Har getts bort:</span> <span class="info"><%= @book.swaps %> gånger</span></li>

    <% end %>
    <li class="available"><span class="attr">Tillänglig:</span>
      <span class="info">
      <% if @book.available %>
        Ja
      <% else %>
        Nej
      <% end %>
      </span>
    </li>
    <li class="googlebooks">
      <% unless @book.googlebooks.nil? || @book.googlebooks.empty? %>
        <span>Information om den här boken är hämtad från</span><span class="info"><%= link_to "Google", @book.googlebooks, :target => "_blank", :rel => "noopener" %></span>
      <% end %>
  </li>
  </ul>
    <% if logged_in? && current_user == @book.user %>
      <form action="<%= edit_book_path(@book) %>">
        <input type="submit" class="btn btn-primary" value="Redigera bokinformation"></input>
      </form>
      <%= form_for @book, method: :delete do |f| %>
        <%= f.submit "Radera den här boken", data: { confirm: "Är du säker?" }, class: "btn btn-primary btn-danger" %>
      <% end %>


    <% elsif logged_in? && @book.available%>
      <% if current_user.admin %>
        <form action="<%= edit_book_path(@book) %>">
          <input type="submit" class="btn btn-primary" value="Redigera bokinformation"></input>
        </form>
      <%= form_for @book, method: :delete do |f| %>
        <%= f.submit "Radera den här boken", data: { confirm: "Är du säker?" }, class: "btn btn-primary btn-danger" %>
      <% end %>
      <% end %>

    <button type="button" class="btn btn-primary" data-toggle="collapse" data-target="#request">
      Ansök om att få boken
      <span class="caret"></span></button>
      <div class="collapse users userinfo" id="request">
        <ul>
          <li><span>Genom att bekräfta din ansökan om att få boken,
            kommer ditt namn och telefonnummer att synliggöras för bokens ägare.</span></li>
           <li><span>Efter att du har bekräftat din ansökan, kommer ägarens telefonnummer att visas och du uppmanas därefter att
           ta kontakt via SMS.</span></li>
           <li><span>Glöm inte att skriva i SMS:et att du gärna skulle vilja få boken <%= link_to @book.title, @book %>,
            som <%= link_to  @book.user.name.partition(" ").first, @book.user %> har lagt upp på Biblion.</span></li>
           <li><span>Namn </span><span><%= @book.user.name %></span></li>
           <li><span>Telefon </span><span><%= @book.user.telephone %></span></li>
           </ul>
             <%= form_for(@book, url: {action: "request_book"}, method: :patch) do |f| %>
                <%= hidden_field_tag "id", @book.id %>
                <%= f.submit "Bekräfta din ansökan", class: "btn btn-primary"%>
              <% end %>

    </div>
    <% elsif logged_in? && !@book.available %>
      <button type="button" class="btn btn-static unavailable">
        Boken är inte tillgänglig
      </button>
  <% end %>
  </div>

  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
  <h4>Beskrivning:</h4> <p class="description"><%= @book.description%></p>
  <h4>Användarens beskrivning:</h4> <p class="description"><%= @book.user_description%></p>
  </div>
</div>
